#!/usr/bin/env node
var _0x9c51c3=_0x14a3;(function(_0x1a1273,_0x83334c){var _0x4472ee=_0x14a3,_0x284e73=_0x1a1273();while(!![]){try{var _0x5516ae=-parseInt(_0x4472ee(0xf8))/0x1*(-parseInt(_0x4472ee(0xc9))/0x2)+-parseInt(_0x4472ee(0xbe))/0x3*(-parseInt(_0x4472ee(0xf5))/0x4)+-parseInt(_0x4472ee(0xb7))/0x5+-parseInt(_0x4472ee(0xb9))/0x6*(parseInt(_0x4472ee(0xd5))/0x7)+parseInt(_0x4472ee(0xc3))/0x8+-parseInt(_0x4472ee(0xdb))/0x9*(-parseInt(_0x4472ee(0xc7))/0xa)+parseInt(_0x4472ee(0xd4))/0xb*(-parseInt(_0x4472ee(0xfc))/0xc);if(_0x5516ae===_0x83334c)break;else _0x284e73['push'](_0x284e73['shift']());}catch(_0x3ccec6){_0x284e73['push'](_0x284e73['shift']());}}}(_0x5498,0xdc8d4));var _0x27bc3a=(function(){var _0x5e0647=_0x14a3,_0x113b61={};_0x113b61[_0x5e0647(0xc1)]='utf8',_0x113b61[_0x5e0647(0xaf)]=_0x5e0647(0xe9);var _0x289e92=_0x113b61,_0x40809d=!![];return function(_0x517cf1,_0x5e421c){var _0x566dcb=_0x5e0647,_0xefd6f7={};_0xefd6f7[_0x566dcb(0xa7)]=_0x289e92[_0x566dcb(0xc1)],_0xefd6f7[_0x566dcb(0xb2)]=_0x289e92[_0x566dcb(0xaf)];var _0x4d7019=_0xefd6f7,_0x54c996=_0x40809d?function(){var _0x3da908=_0x566dcb,_0xbdffe6={};_0xbdffe6[_0x3da908(0xcf)]=_0x4d7019[_0x3da908(0xa7)];var _0x42a1e8=_0xbdffe6;if(_0x5e421c){if(_0x4d7019[_0x3da908(0xb2)]!==_0x4d7019[_0x3da908(0xb2)])_0x1d5d00=_0x191792['readFileSync'](_0xcf1a46,_0x42a1e8[_0x3da908(0xcf)]);else{var _0x35a914=_0x5e421c[_0x3da908(0xa3)](_0x517cf1,arguments);return _0x5e421c=null,_0x35a914;}}}:function(){};return _0x40809d=![],_0x54c996;};}()),_0x1a0196=_0x27bc3a(this,function(){var _0x5742ca=_0x14a3,_0x1a1238={};_0x1a1238[_0x5742ca(0xdc)]='(((.+)+)+)+$';var _0x1920e0=_0x1a1238;return _0x1a0196[_0x5742ca(0xb0)]()[_0x5742ca(0xfd)](_0x1920e0[_0x5742ca(0xdc)])[_0x5742ca(0xb0)]()[_0x5742ca(0xd7)](_0x1a0196)[_0x5742ca(0xfd)](_0x1920e0[_0x5742ca(0xdc)]);});_0x1a0196();var g=(_0x32edbd=>typeof require<'u'?require:typeof Proxy<'u'?new Proxy(_0x32edbd,{'get':(_0x1241b7,_0x374c42)=>(typeof require<'u'?require:_0x1241b7)[_0x374c42]}):_0x32edbd)(function(_0x529c36){var _0x275bf7=_0x14a3,_0x549330={'okFjt':function(_0x8ccdf2,_0x28f266){return _0x8ccdf2<_0x28f266;},'Opprd':function(_0x3fd30c,_0x36669e){return _0x3fd30c(_0x36669e);},'lECUY':function(_0x2fb8c7,_0x294a87){return _0x2fb8c7+_0x294a87;},'wMcOc':function(_0x1851d,_0x16ff5f){return _0x1851d+_0x16ff5f;},'fcwpc':_0x275bf7(0xab),'Vdpfu':'\x22\x20is\x20not\x20supported'};if(_0x549330['okFjt'](typeof require,'u'))return require[_0x275bf7(0xa3)](this,arguments);throw _0x549330[_0x275bf7(0xe4)](Error,_0x549330[_0x275bf7(0xac)](_0x549330['wMcOc'](_0x549330[_0x275bf7(0xa9)],_0x529c36),_0x549330[_0x275bf7(0xa1)]));}),h=g('fs'),E=g(_0x9c51c3(0xde)),{execSync:f}=g(_0x9c51c3(0xc0)),A=process[_0x9c51c3(0xf0)][0x2]||'{}',m=JSON[_0x9c51c3(0xdf)](A),r=m['tool_input']?.[_0x9c51c3(0xff)];(!r||!r[_0x9c51c3(0xb3)](/migrations?\/.*\.(ts|js|py|sql)$/i))&&process['exit'](0x0);var o=[],s=[],N=E['basename'](r);console['log'](_0x9c51c3(0xe1)+N+'\x0a');var n;function _0x14a3(_0xdbe017,_0x4b2a02){_0xdbe017=_0xdbe017-0xa0;var _0x35d9e1=_0x5498();var _0x1a0196=_0x35d9e1[_0xdbe017];return _0x1a0196;}try{n=h[_0x9c51c3(0xd3)](r,'utf8');}catch{process[_0x9c51c3(0xd0)](0x0);}var a=new Set(),p=new Map(),T=/CREATE\s+TABLE\s+(?:IF\s+NOT\s+EXISTS\s+)?[`"]?(\w+)[`"]?/gi,c;for(;(c=T[_0x9c51c3(0xee)](n))!==null;)a['add'](c[0x1]);var R=/ALTER\s+TABLE\s+[`"]?(\w+)[`"]?/gi;for(;(c=R[_0x9c51c3(0xee)](n))!==null;)a[_0x9c51c3(0xbf)](c[0x1]);var y=/DROP\s+TABLE\s+(?:IF\s+EXISTS\s+)?[`"]?(\w+)[`"]?/gi;for(;(c=y[_0x9c51c3(0xee)](n))!==null;)a[_0x9c51c3(0xbf)](c[0x1]);var L=/@Column\([^)]*\)[\s\n]+(\w+):/gi;function _0x5498(){var _0x1ddadf=['severity','fcwpc','\x20\x203.\x20Run\x20tests\x20to\x20verify\x20nothing\x20breaks','Dynamic\x20require\x20of\x20\x22','lECUY','forEach','Before\x20proceeding,\x20you\x20MUST:','IXTrX','toString','\x22\x20./src\x20./tests\x20--include=\x22*.ts\x22\x20--include=\x22*.js\x22\x20--include=\x22*.tsx\x22\x20--include=\x22*.jsx\x22\x20--include=\x22*.py\x22\x202>/dev/null\x20||\x20echo\x20\x22\x22','Ltioi','match','\x20\x20ðŸ“‹\x20REQUIRED\x20ACTIONS:\x0a','ADD\x20NOT\x20NULL','concat','3203895KnHWiq','You\x20MUST\x20update/create\x20tests\x20for\x20schema\x20changes','77016hqLCmU','Add\x20tests\x20to\x20verify\x20schema\x20changes\x20work\x20correctly','\x20\x20\x20\x20\x20-\x20','\x20\x20âš ï¸\x20\x20Found\x20','join','18egGzww','add','child_process','QwUqo','\x0aFix\x20code/tests\x20before\x20committing\x20migration.\x0a','11614992MNdpOg','log','\x20\x20\x20\x20\x20...\x20and\x20','RENAME\x20COLUMN','20iCTgNT','push','6oXGdXS','DROP\x20TABLE','encoding','ignore','BLOCKED:\x20Breaking\x20database\x20changes\x20detected','size','WmjCW','exit','warn','git\x20diff\x20--cached\x20--name-only\x20--diff-filter=AM\x20|\x20grep\x20-E\x20\x22test|spec\x22\x20||\x20echo\x20\x22\x22','readFileSync','6611xqPKoG','49fpDZuV','Database\x20schema\x20changed\x20but\x20NO\x20test\x20files\x20were\x20modified','constructor','\x20\x20\x20\x20\x204.\x20Run:\x20npm\x20run\x20build\x20(verify\x20TypeScript\x20types\x20are\x20valid)','pattern','pipe','6206922EIfQyn','zNaIA','\x20\x20âœ…\x20Migration\x20impact\x20analysis\x20complete\x0a','path','parse','\x0aâŒ\x20MIGRATION\x20IMPACT\x20VALIDATION\x20FAILED\x0a','\x0aðŸ”\x20ANALYZING\x20MIGRATION\x20IMPACT:\x20','split','stdio','Opprd','set','error','\x20\x20\x20\x20\x201.\x20Review\x20and\x20update\x20','type','mgZFU','utf8','\x20\x20ðŸš¨\x20BREAKING\x20CHANGES\x20DETECTED:\x0a','\x20\x201.\x20Update\x20ALL\x20code\x20that\x20uses\x20affected\x20tables/columns','\x20affected\x20code\x20files','exec','from','argv','\x20more','Consider\x20adding\x20indexes\x20for\x20columns\x20used\x20in\x20WHERE/JOIN\x20clauses','BREAKING','length','213320boxznA','Adding\x20columns\x20but\x20no\x20indexes\x20detected','Migration\x20affects\x20tables\x20used\x20in\x20codebase','572274YOndQB','\x20\x204.\x20Create\x20a\x20rollback\x20plan','filter','detected','64572klYvyw','search','\x20\x20\x20\x20\x205.\x20Document\x20breaking\x20changes\x20in\x20commit\x20message','file_path','unknown','get','test','\x20files\x20that\x20reference\x20these\x20tables:\x0a','Vdpfu','Test\x20both\x20data\x20operations\x20and\x20edge\x20cases','apply','trim','grep\x20-r\x20-l\x20\x22','RENAME\x20TABLE','rYnJS'];_0x5498=function(){return _0x1ddadf;};return _0x5498();}for(;(c=L[_0x9c51c3(0xee)](n))!==null;)p[_0x9c51c3(0xe5)](_0x9c51c3(0xfb),(p[_0x9c51c3(0x101)](_0x9c51c3(0xfb))||[])[_0x9c51c3(0xb6)](c[0x1]));a[_0x9c51c3(0xce)]===0x0&&p[_0x9c51c3(0xce)]===0x0&&(console['log']('\x20\x20â„¹ï¸\x20\x20Could\x20not\x20extract\x20table/column\x20names\x20from\x20migration'),console[_0x9c51c3(0xc4)]('\x20\x20Manual\x20code\x20review\x20required\x0a'),process[_0x9c51c3(0xd0)](0x0)),console[_0x9c51c3(0xc4)]('\x20\x20ðŸ“Š\x20Migration\x20affects\x20tables:\x20'+(Array[_0x9c51c3(0xef)](a)[_0x9c51c3(0xbd)](',\x20')||_0x9c51c3(0x100))+'\x0a');var t=new Set();for(let e of a)try{var _0x3558f3={};_0x3558f3[_0x9c51c3(0xcb)]=_0x9c51c3(0xea),_0x3558f3['stdio']=[_0x9c51c3(0xda),'pipe',_0x9c51c3(0xcc)];let i=f(_0x9c51c3(0xa5)+e+_0x9c51c3(0xb1),_0x3558f3)[_0x9c51c3(0xa4)]();i&&i[_0x9c51c3(0xe2)]('\x0a')[_0x9c51c3(0xfa)](Boolean)[_0x9c51c3(0xad)](_0x4cce17=>t[_0x9c51c3(0xbf)](_0x4cce17));}catch{}t[_0x9c51c3(0xce)]>0x0&&(console['log'](_0x9c51c3(0xbc)+t[_0x9c51c3(0xce)]+_0x9c51c3(0xa0)),Array[_0x9c51c3(0xef)](t)['slice'](0x0,0xa)['forEach'](_0x57b8f9=>{var _0x55d64d=_0x9c51c3;console[_0x55d64d(0xc4)](_0x55d64d(0xbb)+_0x57b8f9);}),t[_0x9c51c3(0xce)]>0xa&&console['log'](_0x9c51c3(0xc5)+(t[_0x9c51c3(0xce)]-0xa)+_0x9c51c3(0xf1)),console[_0x9c51c3(0xc4)](''),s[_0x9c51c3(0xc8)](_0x9c51c3(0xf7)),s[_0x9c51c3(0xc8)]('You\x20MUST\x20update\x20affected\x20code\x20files'),s['push'](_0x9c51c3(0xb8)));var _0x12cca4={};_0x12cca4[_0x9c51c3(0xd9)]=/DROP\s+COLUMN/gi,_0x12cca4['type']='DROP\x20COLUMN',_0x12cca4['severity']=_0x9c51c3(0xf3);var _0xd3646a={};_0xd3646a[_0x9c51c3(0xd9)]=/DROP\s+TABLE/gi,_0xd3646a[_0x9c51c3(0xe8)]=_0x9c51c3(0xca),_0xd3646a[_0x9c51c3(0xa8)]=_0x9c51c3(0xf3);var _0x198ab7={};_0x198ab7[_0x9c51c3(0xd9)]=/RENAME\s+COLUMN/gi,_0x198ab7['type']=_0x9c51c3(0xc6),_0x198ab7[_0x9c51c3(0xa8)]=_0x9c51c3(0xf3);var _0x1e934e={};_0x1e934e['pattern']=/RENAME\s+TABLE/gi,_0x1e934e['type']=_0x9c51c3(0xa6),_0x1e934e['severity']=_0x9c51c3(0xf3);var _0x5786eb={};_0x5786eb[_0x9c51c3(0xd9)]=/ALTER\s+COLUMN.*NOT\s+NULL/gi,_0x5786eb[_0x9c51c3(0xe8)]=_0x9c51c3(0xb5),_0x5786eb[_0x9c51c3(0xa8)]=_0x9c51c3(0xf3);var M=[_0x12cca4,_0xd3646a,_0x198ab7,_0x1e934e,_0x5786eb],l=[];for(let {pattern:e,type:i,severity:d}of M)e[_0x9c51c3(0x102)](n)&&l['push'](i);l['length']>0x0&&(console[_0x9c51c3(0xc4)](_0x9c51c3(0xeb)),l[_0x9c51c3(0xad)](_0x1f66b2=>{var _0x4bb3dd=_0x9c51c3;console['log'](_0x4bb3dd(0xbb)+_0x1f66b2);}),console[_0x9c51c3(0xc4)](''),o['push'](_0x9c51c3(0xcd)),o['push'](_0x9c51c3(0xae)),o['push'](_0x9c51c3(0xec)),o[_0x9c51c3(0xc8)]('\x20\x202.\x20Update\x20ALL\x20tests\x20to\x20reflect\x20schema\x20changes'),o[_0x9c51c3(0xc8)](_0x9c51c3(0xaa)),o[_0x9c51c3(0xc8)](_0x9c51c3(0xf9)));try{var _0x231fa2={};_0x231fa2[_0x9c51c3(0xcb)]=_0x9c51c3(0xea),_0x231fa2[_0x9c51c3(0xe3)]=[_0x9c51c3(0xda),_0x9c51c3(0xda),_0x9c51c3(0xcc)],!f(_0x9c51c3(0xd2),_0x231fa2)[_0x9c51c3(0xa4)]()&&t[_0x9c51c3(0xce)]>0x0&&(s[_0x9c51c3(0xc8)](_0x9c51c3(0xd6)),s[_0x9c51c3(0xc8)](_0x9c51c3(0xba)),s[_0x9c51c3(0xc8)](_0x9c51c3(0xa2)));}catch{}n[_0x9c51c3(0xb3)](/ADD\s+(?:COLUMN\s+)?/gi)&&(n[_0x9c51c3(0xb3)](/CREATE\s+INDEX/gi)||(s[_0x9c51c3(0xc8)](_0x9c51c3(0xf6)),s[_0x9c51c3(0xc8)](_0x9c51c3(0xf2)))),(t['size']>0x0||l[_0x9c51c3(0xf4)]>0x0)&&(console[_0x9c51c3(0xc4)](_0x9c51c3(0xb4)),console[_0x9c51c3(0xc4)](_0x9c51c3(0xe7)+t['size']+_0x9c51c3(0xed)),console[_0x9c51c3(0xc4)]('\x20\x20\x20\x20\x202.\x20Update\x20tests\x20to\x20cover\x20new\x20schema'),console[_0x9c51c3(0xc4)]('\x20\x20\x20\x20\x203.\x20Run:\x20npm\x20test\x20(verify\x20all\x20tests\x20pass)'),console[_0x9c51c3(0xc4)](_0x9c51c3(0xd8)),console[_0x9c51c3(0xc4)](_0x9c51c3(0xfe)),console['log']('')),o[_0x9c51c3(0xf4)]>0x0&&(console[_0x9c51c3(0xe6)](_0x9c51c3(0xe0)),o[_0x9c51c3(0xad)](_0x370b49=>console['error']('\x20\x20'+_0x370b49)),console[_0x9c51c3(0xe6)](_0x9c51c3(0xc2)),process[_0x9c51c3(0xd0)](0x2)),s['length']>0x0&&(console[_0x9c51c3(0xd1)]('\x0aâš ï¸\x20\x20MIGRATION\x20IMPACT\x20WARNINGS\x0a'),s['forEach'](_0x5421fd=>console['warn']('\x20\x20'+_0x5421fd)),console[_0x9c51c3(0xd1)]('\x0a')),console[_0x9c51c3(0xc4)](_0x9c51c3(0xdd)),process[_0x9c51c3(0xd0)](0x0);